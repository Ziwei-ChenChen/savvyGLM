<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>savvyGLM: Shrinkage Methods for Generalized Linear Models â€¢ savvyGLM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.2.1/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.2.1/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="savvyGLM: Shrinkage Methods for Generalized Linear Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">savvyGLM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/savvyGLM.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>savvyGLM: Shrinkage Methods for Generalized Linear Models</h1>
            
      

      <div class="d-none name"><code>savvyGLM.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><em>Generalized Linear Models (GLMs)</em> are widely used for
analyzing multivariate data with non-normal responses. The
<em>Iteratively Reweighted Least Squares (IRLS)</em> algorithm is the
main workhorse for fitting these models in small to medium-scale
problems because it reduces the estimation problem to a series of
<em>Weighted Least Squares (WLS)</em> subproblems, which are
computationally less expensive than solving the full maximum likelihood
optimization directly.</p>
<p>However, IRLS can be sensitive to convergence issuesâ€”especially when
using the standard <em>Ordinary Least Squares (OLS)</em> update in each
iteration. In cases of model mis-specification or high variability in
the data, the OLS estimator may yield significant estimation error. The
<code>glm2</code> package improves upon the standard <code>glm</code> by
incorporating a step-halving strategy to better handle convergence
challenges. This robust framework is implemented in its
<code>glm.fit2</code> function.</p>
<p>In the <code>savvyGLM</code> package, we build on the robust
framework provided by the <code>glm2</code> package (and its function
<code>glm.fit2</code>) by replacing the standard OLS update in the IRLS
algorithm with a shrinkage estimator. The rationale is that shrinkage
estimation introduces a small bias to substantially reduce the <em>Mean
Squared Error (MSE)</em> of the OLS estimates, resulting in more
reliable parameter estimates and enhanced convergence stability. The
corresponding shrinkage paper can be find in <a href="http//...">Slab
and Shrinkage Linear Regression Estimation</a>.</p>
<p><a href="#id_...">Simulation studies</a> and <a href="#id_...">real-data applications</a> demonstrate that replacing the
OLS update in IRLS with a shrinkage estimator improves the convergence
and overall performance of GLM estimation compared to the traditional
non-penalized implementation.</p>
<p>In summary, our package modifies <code>glm.fit2</code> from
<code>glm2</code> to:</p>
<ul>
<li><p>Leverage robust features, such as step-halving, already present
in <code>glm2</code>.</p></li>
<li><p>Replace the OLS update with one of several shrinkage estimators
(e.g., <code>St_ost</code>, <code>DSh_ost</code>, <code>SR_ost</code>,
<code>GSR_ost</code>, and optionally <code>Sh_ost</code>).</p></li>
<li><p>Employ parallelization when multiple candidate methods are
specified.</p></li>
</ul>
<p>For more details, please see:</p>
<p>Asimit, V., Chen, Z., Dimitrova, D., Xie, Y., &amp; Zhang, Y. (2025).
<a href="http//...">Shrinkage GLM Modeling</a>.</p>
<div class="section level3">
<h3 id="main-features">Main Features<a class="anchor" aria-label="anchor" href="#main-features"></a>
</h3>
<p><code>savvyGLM</code> provides five classes of shrinkage methods for
GLMs, although by default four are evaluated unless the user explicitly
includes <code>Sh</code>(since Sh is time-consuming):</p>
<ol style="list-style-type: decimal">
<li><p><a href="#">Custom Optimization Methods:</a> Implements shrinkage
estimators (<code>St_ost</code>, <code>DSh_ost</code>,
<code>SR_ost</code>, <code>GSR_ost</code>, and optionally
<code>Sh_ost</code>) that replace the standard OLS update in
IRLS.</p></li>
<li><p><a href="#">Flexible Model Choice:</a> The model_class argument
allows users to choose one or more shrinkage methods. By default, only
<code>"St"</code>, <code>"DSh"</code>, <code>"SR"</code>, and
<code>"GSR"</code> are evaluated. Including <code>"Sh"</code> is
optional because solving the Sylvester equation required by
<code>Sh_ost</code> is computationally intensive.</p></li>
</ol>
<ul>
<li>
<a href="#">Parallel Evaluation:</a> When multiple candidate methods
are specified, the function evaluates them in parallel (if use_parallel
= TRUE) and selects the final model based on the lowest Akaike
Information Criterion (AIC).</li>
</ul>
</div>
<div class="section level3">
<h3 id="key-argument-and-output-summary">Key Argument and Output Summary<a class="anchor" aria-label="anchor" href="#key-argument-and-output-summary"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th><strong>Argument</strong></th>
<th><strong>Description</strong></th>
<th><strong>Default</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>x</code></td>
<td>A numeric matrix of predictors. As for <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/glm.fit.html" class="external-link"><code>glm.fit</code></a>.</td>
<td><strong>No default; user must supply.</strong></td>
</tr>
<tr class="even">
<td><code>y</code></td>
<td>A numeric vector of responses. As for <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/glm.fit.html" class="external-link"><code>glm.fit</code></a>.</td>
<td><strong>No default; user must supply.</strong></td>
</tr>
<tr class="odd">
<td><code>weights</code></td>
<td>An optional vector of weights to be used in the fitting
process.</td>
<td><code>rep(1, nobs)</code></td>
</tr>
<tr class="even">
<td><code>model_class</code></td>
<td>A character vector specifying the shrinkage model(s) to be used.
Allowed values are <code>"St"</code>, <code>"DSh"</code>,
<code>"SR"</code>, <code>"GSR"</code>, and <code>"Sh"</code>. If
multiple values are given, they are run in parallel and the best is
chosen by AIC. If <code>"Sh"</code> is not included, it is omitted from
the evaluation.</td>
<td><code>c("St", "DSh", "SR", "GSR")</code></td>
</tr>
<tr class="odd">
<td>
<code>start</code>, <code>etastart</code>, <code>mustart</code>
</td>
<td>Optional starting values for the parameters, the linear predictor,
and the mean, respectively.</td>
<td><code>NULL</code></td>
</tr>
<tr class="even">
<td><code>offset</code></td>
<td>An optional offset to be included in the model.</td>
<td><code>rep(0, nobs)</code></td>
</tr>
<tr class="odd">
<td><code>family</code></td>
<td>A function specifying the conditional distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>âˆ£</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">Y \mid X</annotation></semantics></math>,
e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>âˆ£</mo><mi>X</mi><mo>âˆ¼</mo><mtext mathvariant="normal">family</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>g</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mi>Î²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y \mid X \sim \text{family}(g^{-1}(X\beta))</annotation></semantics></math>.
(e.g., <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code>, <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>,
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code>).</td>
<td><code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code></td>
</tr>
<tr class="even">
<td><code>control</code></td>
<td>A list of parameters for controlling the fitting process (e.g.,
<code>maxit</code>, <code>epsilon</code>). Similar to <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/glm.control.html" class="external-link"><code>glm.control</code></a>.</td>
<td><code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code></td>
</tr>
<tr class="odd">
<td><code>intercept</code></td>
<td>A logical value indicating whether an intercept should be included
in the model.</td>
<td><code>TRUE</code></td>
</tr>
<tr class="even">
<td><code>use_parallel</code></td>
<td>Logical. If <code>TRUE</code>, multiple methods in
<code>model_class</code> are evaluated in parallel. If only one method
is specified, it is run directly. The best model is chosen by the lowest
AIC among the methods tested.</td>
<td><code>TRUE</code></td>
</tr>
<tr class="odd">
<td><strong>Key Output</strong></td>
<td><strong>Description</strong></td>
<td><strong>Notes</strong></td>
</tr>
<tr class="even">
<td><code>chosen_fit</code></td>
<td>The name of the shrinkage method selected based on the lowest AIC.
If only one method is specified in <code>model_class</code>, then
<code>chosen_fit</code> will simply return that methodâ€™s name.</td>
<td>Returned in the final model object.</td>
</tr>
<tr class="odd">
<td>
<code>coefficients</code>, <code>residuals</code>, etc.</td>
<td>The usual GLM components, similar to those returned by <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/glm.fit.html" class="external-link"><code>glm.fit</code></a>.</td>
<td>See documentation for full details.</td>
</tr>
</tbody>
</table>
<p>This vignette provides an overview of the methods implemented in
<code>savvyGLM</code> and demonstrates how to use them on <a href="#simulation-examples">simulated data</a> and <a href="#real-data-analysis">real data</a>. We begin with a theoretical
overview of each shrinkage class and GLM with IRLS, then walk through
simulation examples that illustrate how to apply <code>savvyGLM</code>
for each method.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="theoretical-overview">Theoretical Overview<a class="anchor" aria-label="anchor" href="#theoretical-overview"></a>
</h2>
<div class="section level3">
<h3 id="shrinkage-estimators">Shrinkage estimators<a class="anchor" aria-label="anchor" href="#shrinkage-estimators"></a>
</h3>
<p>The underlying optimization methods in <code>savvyGLM</code> are
designed to reduce the theoretical mean square error by introducing a
small bias that yields a substantial reduction in variance. This
trade-off leads to more reliable parameter estimates and improved
convergence properties in Generalized Linear Models.</p>
<p>Here, we just provide a table summary since for a detailed
theoretical overview of the shrinkage estimators applied to GLMs, please
refer to the <a href="https://ziwei-chenchen.github.io/savvySh/" class="external-link">savvySh
package</a>, which covers many of the same shrinkage estimators used
here, but in the context of linear regression. The methods in
<code>savvyGLM</code> extend these ideas to generalized linear models,
ensuring that the IRLS updates incorporate shrinkage at each
iteration.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th><strong>Method</strong></th>
<th><strong>Shrinkage Approach</strong></th>
<th><strong>Simple Description</strong></th>
<th><strong>Extra Overhead?</strong></th>
<th><strong>Included by Default?</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>OLS</strong></td>
<td>No shrinkage</td>
<td>Baseline estimator without any regularization.</td>
<td>No</td>
<td>No (baseline method)</td>
</tr>
<tr class="even">
<td><strong>St</strong></td>
<td>Scalar shrinkage</td>
<td>Scales all OLS coefficients by a common factor to reduce MSE.</td>
<td>No</td>
<td><strong>Yes</strong></td>
</tr>
<tr class="odd">
<td><strong>DSh</strong></td>
<td>Diagonal matrix</td>
<td>Shrinks each OLS coefficient separately using individual
factors.</td>
<td>No</td>
<td><strong>Yes</strong></td>
</tr>
<tr class="even">
<td><strong>SR</strong></td>
<td>Slab penalty (1 direction)</td>
<td>Adds a penalty that shrinks the estimate along a fixed direction
(e.g., all-ones vector).</td>
<td>No</td>
<td><strong>Yes</strong></td>
</tr>
<tr class="odd">
<td><strong>GSR</strong></td>
<td>Slab penalty (multiple directions)</td>
<td>Generalizes SR by penalizing multiple directions, often from
eigenvectors.</td>
<td>No</td>
<td><strong>Yes</strong></td>
</tr>
<tr class="even">
<td><strong>Sh</strong></td>
<td>Full matrix (<em>Sylvester equation</em>)</td>
<td>Applies a matrix transformation to OLS using a solution to the
<em>Sylvester equation</em>.</td>
<td>
<strong>Yes</strong> (computational)</td>
<td>No (only if specified in <code>model_class</code>)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="generalized-linear-model-and-its-irls-implementation">Generalized Linear Model and its IRLS Implementation<a class="anchor" aria-label="anchor" href="#generalized-linear-model-and-its-irls-implementation"></a>
</h3>
<p>A GLM assumes that a response variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
defined on some set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ’´</mi><mo>âŠ†</mo><mi>â„œ</mi></mrow><annotation encoding="application/x-tex">\mathcal{Y} \subseteq \Re</annotation></semantics></math>,
is related to a set of covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ—</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math>
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ’³</mi><mo>âŠ†</mo><mi>â„œ</mi><msup><mi></mi><mi>d</mi></msup></mrow><annotation encoding="application/x-tex">\mathcal{X} \subseteq \Re{^d}</annotation></semantics></math>.
The conditional distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
belongs to the exponential dispersion family, with probability density
or mass function</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>Y</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>;</mo><mi>Î¸</mi><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.278em"></mspace><mo>=</mo><mspace width="0.278em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mfrac><mrow><mi>Î¸</mi><mspace width="0.167em"></mspace><mi>y</mi><mo>âˆ’</mo><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¸</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="0.278em"></mspace><mo>+</mo><mspace width="0.278em"></mspace><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
f_Y(y; \theta, \phi) \;=\; \exp\left\{\frac{\theta\,y - b(\theta)}{a(\phi)} \;+\; c(y, \phi)\right\},
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¸</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
is the canonical parameter,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï•</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the dispersion parameter, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
are known functions. The mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is linked to a linear predictor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î·</mi><mi>i</mi></msub><mo>=</mo><msubsup><mi>ğ±</mi><mi>i</mi><mi>âŠ¤</mi></msubsup><mi>ğ›ƒ</mi></mrow><annotation encoding="application/x-tex">\eta_i = \mathbf{x}_i^\top \boldsymbol{\beta}</annotation></semantics></math>
through a link function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>,
so that</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ”¼</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>âˆ£</mo><msub><mi>ğ—</mi><mi>i</mi></msub><mo>=</mo><msub><mi>ğ±</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="0.278em"></mspace><mo>=</mo><mspace width="0.278em"></mspace><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>ğ±</mi><mi>i</mi><mi>âŠ¤</mi></msubsup><mi>ğ›ƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\mathbb{E}[Y_i \mid \mathbf{X}_i = \mathbf{x}_i] \;=\; h\left(\mathbf{x}_i^\top \boldsymbol{\beta}\right),
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><msup><mi>g</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">h = g^{-1}</annotation></semantics></math>
is the inverse of the link. Under a canonical link,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>â‹…</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>b</mi><mi>â€²</mi></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>â‹…</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(\cdot) = b^\prime(\cdot)</annotation></semantics></math>.</p>
<p>For an independent sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mrow><mo stretchy="true" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ğ±</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><annotation encoding="application/x-tex">\left\{(y_i, \mathbf{x}_i)\right\}_{i=1}^n</annotation></semantics></math>,
the log-likelihood for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ƒ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
can be written as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â„“</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›ƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.278em"></mspace><mo>=</mo><mspace width="0.278em"></mspace><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mfrac><mrow><msub><mi>Î¸</mi><mi>i</mi></msub><mspace width="0.167em"></mspace><msub><mi>y</mi><mi>i</mi></msub><mspace width="0.278em"></mspace><mo>âˆ’</mo><mspace width="0.278em"></mspace><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¸</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="0.278em"></mspace><mo>+</mo><mspace width="0.278em"></mspace><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>,</mo><mi>Ï•</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\ell(\boldsymbol{\beta}) 
\;=\; \sum_{i=1}^n \frac{\theta_i\,y_i \;-\; b(\theta_i)}{a(\phi)} \;+\; c\left(y_i, \phi\right),
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>i</mi></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>b</mi><mi>â€²</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msup><mo>âˆ˜</mo><mspace width="0.167em"></mspace><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>ğ±</mi><mi>i</mi><mi>âŠ¤</mi></msubsup><mi>ğ›ƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_i = (b^\prime)^{-1}\circ\, h\left(\mathbf{x}_i^\top \boldsymbol{\beta}\right)</annotation></semantics></math>.
Maximizing this log-likelihood is equivalent to minimizing the following
objective function,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ’</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›ƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.278em"></mspace><mo>=</mo><mspace width="0.278em"></mspace><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¸</mi><mi>i</mi></msub><mspace width="0.167em"></mspace><msub><mi>y</mi><mi>i</mi></msub><mspace width="0.278em"></mspace><mo>âˆ’</mo><mspace width="0.278em"></mspace><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¸</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathcal{C}(\boldsymbol{\beta}) 
\;=\; -\sum_{i=1}^n \left(\theta_i\,y_i \;-\; b(\theta_i)\right).
</annotation></semantics></math></p>
<p>Taking the derivative of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ’</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›ƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{C}(\boldsymbol{\beta})</annotation></semantics></math>
with respect to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ƒ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
leads to the so-called normal equations, which can be solved
iteratively. In particular, the IRLS algorithm reformulates each
iteration as a WLS problem:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mover><mi>ğ›ƒ</mi><mo accent="true">Ì‚</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mspace width="0.278em"></mspace><mo>=</mo><mspace width="0.278em"></mspace><munder><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">g</mi><mspace width="0.167em"></mspace><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mi>ğ›ƒ</mi></munder><mspace width="0.278em"></mspace><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ğ³</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>âˆ’</mo><mi>ğ—</mi><mspace width="0.167em"></mspace><mi>ğ›ƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>âŠ¤</mi></msup><msup><mi>ğ–</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ğ³</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>âˆ’</mo><mi>ğ—</mi><mspace width="0.167em"></mspace><mi>ğ›ƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\widehat{\boldsymbol{\beta}}^{(t+1)} 
\;=\; \underset{\boldsymbol{\beta}}{\mathrm{arg\,min}}
\;\left(\mathbf{z}^{(t)} - \mathbf{X}\,\boldsymbol{\beta}\right)^\top
\mathbf{W}^{(t)}
\left(\mathbf{z}^{(t)} - \mathbf{X}\,\boldsymbol{\beta}\right),
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ğ–</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\mathbf{W}^{(t)}</annotation></semantics></math>
is the diagonal matrix of weights and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ğ³</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\mathbf{z}^{(t)}</annotation></semantics></math>
is the pseudo-response at iteration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
Specifically,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>ğ–</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mspace width="0.278em"></mspace><mo>=</mo><mspace width="0.278em"></mspace><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">g</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>h</mi><mi>â€²</mi></msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î·</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mi>/</mi><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î¼</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msubsup><mi>ğ³</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mspace width="0.278em"></mspace><mo>=</mo><mspace width="0.278em"></mspace><msubsup><mi>Î·</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mspace width="0.278em"></mspace><mo>+</mo><mspace width="0.278em"></mspace><mfrac><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msubsup><mi>Î¼</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup></mrow><mrow><msup><mi>h</mi><mi>â€²</mi></msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î·</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">
\mathbf{W}^{(t)} 
\;=\; \mathrm{diag}\left(\left(h^\prime(\eta_i^{(t)})\right)^2 / V\left(\mu_i^{(t)}\right)\right),
\quad
\mathbf{z}_i^{(t)} 
\;=\; \eta_i^{(t)} \;+\; \frac{y_i - \mu_i^{(t)}}{h^\prime(\eta_i^{(t)})},
</annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Î¼</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>=</mo><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Î·</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_i^{(t)} = h(\eta_i^{(t)})</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Î·</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>=</mo><msubsup><mi>ğ±</mi><mi>i</mi><mi>âŠ¤</mi></msubsup><msup><mover><mi>ğ›ƒ</mi><mo accent="true">Ì‚</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\eta_i^{(t)} = \mathbf{x}_i^\top \widehat{\boldsymbol{\beta}}^{(t)}</annotation></semantics></math>.
Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(\mu_i)</annotation></semantics></math>
is the variance function determined by the exponential family, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>h</mi><mi>â€²</mi></msup><annotation encoding="application/x-tex">h^\prime</annotation></semantics></math>
is the derivative of the inverse link.</p>
<p>By iterating this WLS problem until convergence (or until a maximum
number of iterations is reached), IRLS provides the maximum likelihood
estimates for the GLM parameters. In <code>savvyGLM</code>, these WLS
updates are further enhanced by applying shrinkage estimators
(<code>St_ost</code>, <code>DSh_ost</code>, <code>SR_ost</code>,
<code>GSR_ost}, or</code>Sh_ost`) at each iteration, thereby improving
estimation accuracy and convergence stability.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="simulation-examples">Simulation Examples<a class="anchor" aria-label="anchor" href="#simulation-examples"></a>
</h2>
<p>This section presents simulation studies to compare the performance
of the shrinkage estimators implemented in the <code>savvyGLM</code>
package. We compare the standard IRLS update (as implemented in
<code>glm.fit2</code>) with various shrinkage methods implemented in
<code>savvyGLM</code> by measuring the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mn>2</mn></msub><annotation encoding="application/x-tex">L_2</annotation></semantics></math>
distance between the estimated and true coefficients. Lower
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mn>2</mn></msub><annotation encoding="application/x-tex">L_2</annotation></semantics></math>
values indicate better estimation accuracy.</p>
<p>The following <em>data-generating processes (DGPs)</em> are
considered for logistic regression (LR), Poisson, and Gamma GLMs with
<em>log</em> link and <em>sqrt</em> link:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Covariate Matrix</strong>: The covariate matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ—</mi><mo>âˆˆ</mo><msup><mi>â„œ</mi><mrow><mi>n</mi><mo>Ã—</mo><mi>p</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbf{X} \in \Re^{n \times p}</annotation></semantics></math>
is drawn from a multivariate normal distribution with mean zero, unit
variances, and a Toeplitz covariance matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î£</mi><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Cov</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>X</mi><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>Ï</mi><mrow><mo stretchy="true" form="prefix">|</mo><mi>i</mi><mo>âˆ’</mo><mi>k</mi><mo stretchy="true" form="postfix">|</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\text{Cov}(X_{i,j}, X_{k,j}) = \rho^{|i-k|}</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï</mi><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>âˆ’</mi><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\rho \in (-1,1)</annotation></semantics></math>.</p></li>
<li><p><strong>True Coefficients</strong>: The true regression
coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î²</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\beta_j</annotation></semantics></math>
are set to alternate in sign and increase in magnitude (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>,</mo><mi>âˆ’</mi><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>âˆ’</mi><mn>2</mn><mo>,</mo><mi>â€¦</mi></mrow><annotation encoding="application/x-tex">1, -1, 2, -2, \dots</annotation></semantics></math>
for LR with the logit link). For Poisson and Gamma GLMs with the log
link, a smaller scaling is used to avoid numerical issues.</p></li>
<li>
<p><strong>Response Generation</strong>:</p>
<ul>
<li><p><strong>Logistic Regression (LR)</strong>: Compute the linear
predictor:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î·</mi><mi>i</mi></msub><mo>=</mo><msub><mi>Î²</mi><mn>0</mn></msub><mo>+</mo><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>p</mi></msubsup><msub><mi>Î²</mi><mi>j</mi></msub><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\eta_i = \beta_0 + \sum_{j=1}^p \beta_j x_{ij}</annotation></semantics></math>
and generate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mtext mathvariant="normal">Binomial</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mi>âˆ’</mi><msub><mi>Î·</mi><mi>i</mi></msub></mrow></msup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_i \sim \text{Binomial}\left(1, \frac{1}{1+e^{-\eta_i}}\right)</annotation></semantics></math>.</p></li>
<li><p><strong>Poisson GLM</strong>:Two link functions are
considered:For the <em>log</em> link:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><msup><mi>e</mi><msub><mi>Î·</mi><mi>i</mi></msub></msup></mrow><annotation encoding="application/x-tex">\mu_i = e^{\eta_i}</annotation></semantics></math>;
for the <em>sqrt</em> link:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><msubsup><mi>Î·</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\mu_i = \eta_i^2</annotation></semantics></math>.
Then, generate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>âˆ¼</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_i \sim \text{Poisson}(\mu_i)</annotation></semantics></math>.</p></li>
<li><p><strong>Gamma GLM</strong>: Similarly, use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><msup><mi>e</mi><msub><mi>Î·</mi><mi>i</mi></msub></msup></mrow><annotation encoding="application/x-tex">\mu_i = e^{\eta_i}</annotation></semantics></math>
(<em>log</em> link) or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><msubsup><mi>Î·</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\mu_i = \eta_i^2</annotation></semantics></math>
(<em>sqrt</em> link), and generate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
from a Gamma distribution with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î¼</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>.</p></li>
</ul>
</li>
</ol>
<p>For each scenario, we fit the GLM using the standard IRLS update
(i.e., OLS-based) and the shrinkage-based IRLS update implemented in
<code>savvyGLM</code>. The performance is assessed using the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mn>2</mn></msub><annotation encoding="application/x-tex">L_2</annotation></semantics></math>
distance between the estimated and true coefficients. Tables comparing
these distances and other relevant diagnostics are provided to
illustrate the benefits of the shrinkage approach. These simulation
studies aims to demonstrate that replacing the OLS update with shrinkage
estimators in the IRLS algorithm improves convergence and estimation
accuracy, especially in challenging settings with multicollinearity or
extreme response values.</p>
<p><strong>Note:</strong> Due to differences in underlying libraries and
random number generation implementations (e.g., BLAS/LAPACK and RNG
behavior), the data generated by functions like <code>mvrnorm</code> may
differ slightly between Windows and macOS/Linux, even with the same
seed.</p>
<div class="section level3">
<h3 id="logistic-regression">Logistic Regression<a class="anchor" aria-label="anchor" href="#logistic-regression"></a>
</h3>
<div class="section level4">
<h4 id="balanced-data">Balanced Data<a class="anchor" aria-label="anchor" href="#balanced-data"></a>
</h4>
<p>In this simulation, balanced binary responses are generated using the
logit link. Covariates are sampled from a multivariate normal
distribution with a Toeplitz covariance matrix determined by various
correlation coefficients. To ensure a balanced dataset, a larger dataset
is first generated, and then a subset is selected to achieve roughly
equal proportions of 0â€™s and 1â€™s. We fit the models using the standard
GLM (via <code>glm.fit2</code>) and the shrinkage-based GLM (via
<code>savvy_glm.fit2</code>in <code>savvyGLM</code> package).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ziwei-ChenChen.github.io/savvyGLM">savvyGLM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'glm2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:MASS':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     crabs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvxr.rbind.io" class="external-link">CVXR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'CVXR'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:MASS':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     huber</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     power</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_val</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">p_val</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">rho_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.75</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">mu_val</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">target_proportion</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">control_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">250</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">family_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sigma.rho</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">theta_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sgn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span></span>
<span>  <span class="va">mag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">sgn</span> <span class="op">*</span> <span class="va">mag</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">findStartingValues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Variable-class.html" class="external-link">Variable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">g_y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">logit_g_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">g_y</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">g_y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">objective</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Minimize-class.html" class="external-link">Minimize</a></span><span class="op">(</span><span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/sum_squares.html" class="external-link">sum_squares</a></span><span class="op">(</span><span class="va">logit_g_y</span> <span class="op">-</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Problem-class.html" class="external-link">Problem</a></span><span class="op">(</span><span class="va">objective</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OLS"</span>, <span class="st">"SR"</span>, <span class="st">"GSR"</span>, <span class="st">"St"</span>, <span class="st">"DSh"</span>, <span class="st">"Sh"</span><span class="op">)</span></span>
<span><span class="va">l2_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span>,</span>
<span>                    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"rho="</span>, <span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">&lt;-</span> <span class="va">rho_vals</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu">sigma.rho</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span></span>
<span>  <span class="va">n_val_large</span> <span class="op">&lt;-</span> <span class="va">n_val</span> <span class="op">*</span> <span class="fl">10</span></span>
<span>  </span>
<span>  <span class="va">X_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">n_val_large</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mu_val</span>, <span class="va">p_val</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span></span>
<span>  <span class="va">X_large_intercept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X_large</span><span class="op">)</span></span>
<span>  <span class="va">beta_true</span> <span class="op">&lt;-</span> <span class="fu">theta_func</span><span class="op">(</span><span class="va">p_val</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">mu_y_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">X_large_intercept</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_true</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_val_large</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">mu_y_large</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">y_zero_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y_large</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_val</span> <span class="op">*</span> <span class="va">target_proportion</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">y_one_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y_large</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n_val</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_val</span> <span class="op">*</span> <span class="va">target_proportion</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">final_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y_zero_indices</span>, <span class="va">y_one_indices</span><span class="op">)</span></span>
<span>  <span class="va">X_final</span> <span class="op">&lt;-</span> <span class="va">X_large_intercept</span><span class="op">[</span><span class="va">final_indices</span>, <span class="op">]</span></span>
<span>  <span class="va">y_final</span> <span class="op">&lt;-</span> <span class="va">y_large</span><span class="op">[</span><span class="va">final_indices</span><span class="op">]</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu">findStartingValues</span><span class="op">(</span><span class="va">X_final</span>, <span class="va">y_final</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fit_ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glm2/man/glm.fit2.html" class="external-link">glm.fit2</a></span><span class="op">(</span><span class="va">X_final</span>, <span class="va">y_final</span>, start <span class="op">=</span> <span class="va">starting_values</span>,</span>
<span>                      control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>  <span class="va">l2_matrix</span><span class="op">[</span><span class="st">"OLS"</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit_ols</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/savvy_glm.fit2.html">savvy_glm.fit2</a></span><span class="op">(</span><span class="va">X_final</span>, <span class="va">y_final</span>, model_class <span class="op">=</span> <span class="va">m</span>,</span>
<span>                           start <span class="op">=</span> <span class="va">starting_values</span>, control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>    <span class="va">l2_matrix</span><span class="op">[</span><span class="va">m</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A summary table here is produced to compare these distances across
different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
values.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l2_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">l2_matrix</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">l2_table</span>, digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"L2 Distance Between Estimated and True Coefficients (Balanced LR)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>L2 Distance Between Estimated and True Coefficients (Balanced
LR)</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">rho=-0.75</th>
<th align="right">rho=-0.5</th>
<th align="right">rho=0</th>
<th align="right">rho=0.5</th>
<th align="right">rho=0.75</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">OLS</td>
<td align="right">113.9223</td>
<td align="right">370.0605</td>
<td align="right">389.5301</td>
<td align="right">85.0934</td>
<td align="right">1411.1209</td>
</tr>
<tr class="even">
<td align="left">SR</td>
<td align="right">113.9563</td>
<td align="right">370.6068</td>
<td align="right">389.4979</td>
<td align="right">85.0923</td>
<td align="right">1411.7484</td>
</tr>
<tr class="odd">
<td align="left">GSR</td>
<td align="right">119.8898</td>
<td align="right">369.5698</td>
<td align="right">391.3903</td>
<td align="right">81.4199</td>
<td align="right">1413.7821</td>
</tr>
<tr class="even">
<td align="left">St</td>
<td align="right">116.8701</td>
<td align="right">366.5771</td>
<td align="right">388.6831</td>
<td align="right">82.2640</td>
<td align="right">1409.4099</td>
</tr>
<tr class="odd">
<td align="left">DSh</td>
<td align="right">117.7217</td>
<td align="right">365.9178</td>
<td align="right">388.7349</td>
<td align="right">81.8181</td>
<td align="right">1414.8157</td>
</tr>
<tr class="even">
<td align="left">Sh</td>
<td align="right">12.3169</td>
<td align="right">53.2125</td>
<td align="right">62.8100</td>
<td align="right">71.2555</td>
<td align="right">307.2719</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="imbalanced-data">Imbalanced Data<a class="anchor" aria-label="anchor" href="#imbalanced-data"></a>
</h4>
<p>For imbalanced logistic regression, the simulation settings are
similar except that the target proportion for the negative class is
reduced (for example, only 5% of the responses are 0â€™s). This results in
a skewed binary response, which allows us to evaluate the robustness of
the shrinkage estimators under class imbalance. As before, models are
fit using both the standard GLM and the various shrinkage-based GLM.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ziwei-ChenChen.github.io/savvyGLM">savvyGLM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glm2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvxr.rbind.io" class="external-link">CVXR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_val</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">p_val</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">rho_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.75</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">mu_val</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">target_proportion</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">control_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">250</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">family_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sigma.rho</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">theta_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sgn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span></span>
<span>  <span class="va">mag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">sgn</span> <span class="op">*</span> <span class="va">mag</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">findStartingValues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Variable-class.html" class="external-link">Variable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">g_y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>  <span class="va">logit_g_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">g_y</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">g_y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">objective</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Minimize-class.html" class="external-link">Minimize</a></span><span class="op">(</span><span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/sum_squares.html" class="external-link">sum_squares</a></span><span class="op">(</span><span class="va">logit_g_y</span> <span class="op">-</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Problem-class.html" class="external-link">Problem</a></span><span class="op">(</span><span class="va">objective</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OLS"</span>, <span class="st">"SR"</span>, <span class="st">"GSR"</span>, <span class="st">"St"</span>, <span class="st">"DSh"</span>, <span class="st">"Sh"</span><span class="op">)</span></span>
<span><span class="va">l2_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span>,</span>
<span>                    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"rho="</span>, <span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">&lt;-</span> <span class="va">rho_vals</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu">sigma.rho</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span></span>
<span>  <span class="va">n_val_large</span> <span class="op">&lt;-</span> <span class="va">n_val</span> <span class="op">*</span> <span class="fl">10</span></span>
<span>  </span>
<span>  <span class="va">X_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">n_val_large</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mu_val</span>, <span class="va">p_val</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span></span>
<span>  <span class="va">X_large_intercept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X_large</span><span class="op">)</span></span>
<span>  <span class="va">beta_true</span> <span class="op">&lt;-</span> <span class="fu">theta_func</span><span class="op">(</span><span class="va">p_val</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">mu_y_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">X_large_intercept</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_true</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_val_large</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">mu_y_large</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">y_zero_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y_large</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_val</span> <span class="op">*</span> <span class="va">target_proportion</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">y_one_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y_large</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n_val</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">n_val</span> <span class="op">*</span> <span class="va">target_proportion</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">final_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y_zero_indices</span>, <span class="va">y_one_indices</span><span class="op">)</span></span>
<span>  <span class="va">X_final</span> <span class="op">&lt;-</span> <span class="va">X_large_intercept</span><span class="op">[</span><span class="va">final_indices</span>, <span class="op">]</span></span>
<span>  <span class="va">y_final</span> <span class="op">&lt;-</span> <span class="va">y_large</span><span class="op">[</span><span class="va">final_indices</span><span class="op">]</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu">findStartingValues</span><span class="op">(</span><span class="va">X_final</span>, <span class="va">y_final</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fit_ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glm2/man/glm.fit2.html" class="external-link">glm.fit2</a></span><span class="op">(</span><span class="va">X_final</span>, <span class="va">y_final</span>, start <span class="op">=</span> <span class="va">starting_values</span>,</span>
<span>                      control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>  <span class="va">l2_matrix</span><span class="op">[</span><span class="st">"OLS"</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit_ols</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/savvy_glm.fit2.html">savvy_glm.fit2</a></span><span class="op">(</span><span class="va">X_final</span>, <span class="va">y_final</span>, model_class <span class="op">=</span> <span class="va">m</span>,</span>
<span>                           start <span class="op">=</span> <span class="va">starting_values</span>, control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>    <span class="va">l2_matrix</span><span class="op">[</span><span class="va">m</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A summary table here is produced to compare these distances across
different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
values.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l2_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">l2_matrix</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">l2_table</span>, digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"L2 Distance Between Estimated and True Coefficients (Imbalanced LR)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>L2 Distance Between Estimated and True Coefficients (Imbalanced
LR)</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">rho=-0.75</th>
<th align="right">rho=-0.5</th>
<th align="right">rho=0</th>
<th align="right">rho=0.5</th>
<th align="right">rho=0.75</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">OLS</td>
<td align="right">43.8576</td>
<td align="right">76.1059</td>
<td align="right">149.6920</td>
<td align="right">148.9224</td>
<td align="right">416.6273</td>
</tr>
<tr class="even">
<td align="left">SR</td>
<td align="right">43.4368</td>
<td align="right">75.9847</td>
<td align="right">149.3453</td>
<td align="right">148.8895</td>
<td align="right">416.8925</td>
</tr>
<tr class="odd">
<td align="left">GSR</td>
<td align="right">45.6810</td>
<td align="right">75.6519</td>
<td align="right">149.7902</td>
<td align="right">149.3444</td>
<td align="right">418.4628</td>
</tr>
<tr class="even">
<td align="left">St</td>
<td align="right">45.5025</td>
<td align="right">75.1966</td>
<td align="right">149.0896</td>
<td align="right">148.5704</td>
<td align="right">415.2965</td>
</tr>
<tr class="odd">
<td align="left">DSh</td>
<td align="right">44.0459</td>
<td align="right">74.7376</td>
<td align="right">148.6800</td>
<td align="right">148.5846</td>
<td align="right">417.6846</td>
</tr>
<tr class="even">
<td align="left">Sh</td>
<td align="right">26.6729</td>
<td align="right">19.8582</td>
<td align="right">9.2992</td>
<td align="right">12.6352</td>
<td align="right">65.0610</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="poisson-glms">Poisson GLMs<a class="anchor" aria-label="anchor" href="#poisson-glms"></a>
</h3>
<div class="section level4">
<h4 id="log-link-function">Log Link Function<a class="anchor" aria-label="anchor" href="#log-link-function"></a>
</h4>
<p>For Poisson GLMs with the log link, the mean response is modeled as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î·</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu = \exp(\eta)</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î·</mi><mo>=</mo><msub><mi>X</mi><mtext mathvariant="normal">intercept</mtext></msub><mspace width="0.167em"></mspace><msub><mi>Î²</mi><mtext mathvariant="normal">true</mtext></msub></mrow><annotation encoding="application/x-tex">\eta = X_{\text{intercept}} \, \beta_{\text{true}}</annotation></semantics></math>.
In this simulation, covariates are generated from a multivariate normal
distribution with a Toeplitz covariance matrix. The responses are
simulated from a Poisson distribution with rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î·</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu = \exp(\eta)</annotation></semantics></math>.
We fit the models using the standard GLM (via <code>glm.fit2</code>) and
the shrinkage-based GLM (via <code>savvy_glm.fit2</code>in
<code>savvyGLM</code> package).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ziwei-ChenChen.github.io/savvyGLM">savvyGLM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glm2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvxr.rbind.io" class="external-link">CVXR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_val</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">p_val</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">rho_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.75</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">mu_val</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">control_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">250</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">family_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sigma.rho</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">theta_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">base_increment</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span>  <span class="va">growth_rate</span> <span class="op">&lt;-</span> <span class="fl">0.95</span> </span>
<span>  <span class="va">betas</span> <span class="op">&lt;-</span> <span class="va">base_increment</span> <span class="op">*</span> <span class="op">(</span><span class="va">growth_rate</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">p_val</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">betas</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">p_val</span><span class="op">]</span></span>
<span>  <span class="va">signs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span></span>
<span>  <span class="va">betas</span> <span class="op">&lt;-</span> <span class="va">betas</span> <span class="op">*</span> <span class="va">signs</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">findStartingValues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Variable-class.html" class="external-link">Variable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">objective</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Minimize-class.html" class="external-link">Minimize</a></span><span class="op">(</span><span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/sum_squares.html" class="external-link">sum_squares</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">-</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Problem-class.html" class="external-link">Problem</a></span><span class="op">(</span><span class="va">objective</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">starting_values</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OLS"</span>, <span class="st">"SR"</span>, <span class="st">"GSR"</span>, <span class="st">"St"</span>, <span class="st">"DSh"</span>, <span class="st">"Sh"</span><span class="op">)</span></span>
<span><span class="va">l2_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span>,</span>
<span>                    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"rho="</span>, <span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">&lt;-</span> <span class="va">rho_vals</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu">sigma.rho</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">n_val</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mu_val</span>, <span class="va">p_val</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span></span>
<span>  <span class="va">X_intercept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span><span class="op">)</span></span>
<span>  <span class="va">beta_true</span> <span class="op">&lt;-</span> <span class="fu">theta_func</span><span class="op">(</span><span class="va">p_val</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">mu_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X_intercept</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_true</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n_val</span>, lambda <span class="op">=</span> <span class="va">mu_y</span><span class="op">)</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu">findStartingValues</span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fit_ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glm2/man/glm.fit2.html" class="external-link">glm.fit2</a></span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span>, start <span class="op">=</span> <span class="va">starting_values</span>,</span>
<span>                      control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>  <span class="va">l2_matrix</span><span class="op">[</span><span class="st">"OLS"</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit_ols</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/savvy_glm.fit2.html">savvy_glm.fit2</a></span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span>, model_class <span class="op">=</span> <span class="va">m</span>,</span>
<span>                           start <span class="op">=</span> <span class="va">starting_values</span>, control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>    <span class="va">l2_matrix</span><span class="op">[</span><span class="va">m</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A summary table here is produced to compare these distances across
different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l2_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">l2_matrix</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">l2_table</span>, digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"L2 Distance Between Estimated and True Coefficients (log link for Poisson GLM)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>L2 Distance Between Estimated and True Coefficients (log link
for Poisson GLM)</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">rho=-0.75</th>
<th align="right">rho=-0.5</th>
<th align="right">rho=0</th>
<th align="right">rho=0.5</th>
<th align="right">rho=0.75</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">OLS</td>
<td align="right">0.2847</td>
<td align="right">0.2477</td>
<td align="right">0.2115</td>
<td align="right">0.3973</td>
<td align="right">0.3676</td>
</tr>
<tr class="even">
<td align="left">SR</td>
<td align="right">0.2728</td>
<td align="right">0.2142</td>
<td align="right">0.1987</td>
<td align="right">0.3986</td>
<td align="right">0.3677</td>
</tr>
<tr class="odd">
<td align="left">GSR</td>
<td align="right">0.1981</td>
<td align="right">0.1741</td>
<td align="right">0.1870</td>
<td align="right">0.3206</td>
<td align="right">0.3010</td>
</tr>
<tr class="even">
<td align="left">St</td>
<td align="right">0.2473</td>
<td align="right">0.2005</td>
<td align="right">0.1855</td>
<td align="right">0.3273</td>
<td align="right">0.2855</td>
</tr>
<tr class="odd">
<td align="left">DSh</td>
<td align="right">0.2718</td>
<td align="right">0.2473</td>
<td align="right">0.2206</td>
<td align="right">0.3546</td>
<td align="right">0.3501</td>
</tr>
<tr class="even">
<td align="left">Sh</td>
<td align="right">0.2750</td>
<td align="right">0.2437</td>
<td align="right">0.2095</td>
<td align="right">0.3914</td>
<td align="right">0.3579</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="sqrt-link-function">
<em>sqrt</em> Link Function<a class="anchor" aria-label="anchor" href="#sqrt-link-function"></a>
</h4>
<p>For the Poisson GLM with the square-root link, the mean response is
defined as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><msup><mi>Î·</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\mu = \eta^2</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î·</mi><mo>=</mo><msub><mi>X</mi><mtext mathvariant="normal">intercept</mtext></msub><mspace width="0.167em"></mspace><msub><mi>Î²</mi><mtext mathvariant="normal">true</mtext></msub></mrow><annotation encoding="application/x-tex">\eta = X_{\text{intercept}} \, \beta_{\text{true}}</annotation></semantics></math>.
The simulation procedure is similar to the log link case; however, the
responses are generated with Poission distribution with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î»</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><msup><mi>Î·</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\mu=\eta^2</annotation></semantics></math>.
To address potential numerical issues (such as non-positive responses).
Models are then fit using both the standard GLM (via
<code>glm.fit2</code>) and the shrinkage-based GLM (via
<code>savvy_glm.fit2</code>in <code>savvyGLM</code> package).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ziwei-ChenChen.github.io/savvyGLM">savvyGLM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glm2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvxr.rbind.io" class="external-link">CVXR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_val</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">p_val</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">rho_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.75</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">mu_val</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">control_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">250</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">family_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"sqrt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sigma.rho</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">theta_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sgn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span></span>
<span>  <span class="va">mag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">sgn</span> <span class="op">*</span> <span class="va">mag</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">findStartingValues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">epsilon</span> <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Variable-class.html" class="external-link">Variable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">objective</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Minimize-class.html" class="external-link">Minimize</a></span><span class="op">(</span><span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/sum_squares.html" class="external-link">sum_squares</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">-</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">eta</span> <span class="op">&gt;=</span> <span class="va">epsilon</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Problem-class.html" class="external-link">Problem</a></span><span class="op">(</span><span class="va">objective</span>, <span class="va">constraints</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">starting_values</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OLS"</span>, <span class="st">"SR"</span>, <span class="st">"GSR"</span>, <span class="st">"St"</span>, <span class="st">"DSh"</span>, <span class="st">"Sh"</span><span class="op">)</span></span>
<span><span class="va">l2_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span>,</span>
<span>                    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"rho="</span>, <span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">&lt;-</span> <span class="va">rho_vals</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu">sigma.rho</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">n_val</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mu_val</span>, <span class="va">p_val</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span></span>
<span>  <span class="va">X_intercept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span><span class="op">)</span></span>
<span>  <span class="va">beta_true</span> <span class="op">&lt;-</span> <span class="fu">theta_func</span><span class="op">(</span><span class="va">p_val</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">mu_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="op">(</span><span class="va">X_intercept</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_true</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n_val</span>, lambda <span class="op">=</span> <span class="va">mu_y</span><span class="op">)</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu">findStartingValues</span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fit_ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glm2/man/glm.fit2.html" class="external-link">glm.fit2</a></span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span>, start <span class="op">=</span> <span class="va">starting_values</span>,</span>
<span>                      control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>  <span class="va">l2_matrix</span><span class="op">[</span><span class="st">"OLS"</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit_ols</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/savvy_glm.fit2.html">savvy_glm.fit2</a></span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span>, model_class <span class="op">=</span> <span class="va">m</span>,</span>
<span>                           start <span class="op">=</span> <span class="va">starting_values</span>, control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>    <span class="va">l2_matrix</span><span class="op">[</span><span class="va">m</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A summary table here is produced to compare these distances across
different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l2_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">l2_matrix</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">l2_table</span>, digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"L2 Distance Between Estimated and True Coefficients (sqrt link for Poisson GLM)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>L2 Distance Between Estimated and True Coefficients (sqrt link
for Poisson GLM)</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">rho=-0.75</th>
<th align="right">rho=-0.5</th>
<th align="right">rho=0</th>
<th align="right">rho=0.5</th>
<th align="right">rho=0.75</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">OLS</td>
<td align="right">105.6656</td>
<td align="right">82.8127</td>
<td align="right">57.8924</td>
<td align="right">45.0648</td>
<td align="right">40.1208</td>
</tr>
<tr class="even">
<td align="left">SR</td>
<td align="right">107.3804</td>
<td align="right">84.1176</td>
<td align="right">58.0029</td>
<td align="right">45.0435</td>
<td align="right">40.0857</td>
</tr>
<tr class="odd">
<td align="left">GSR</td>
<td align="right">103.4257</td>
<td align="right">81.8108</td>
<td align="right">57.1888</td>
<td align="right">44.9339</td>
<td align="right">40.3197</td>
</tr>
<tr class="even">
<td align="left">St</td>
<td align="right">99.2810</td>
<td align="right">80.5491</td>
<td align="right">57.3508</td>
<td align="right">44.6846</td>
<td align="right">39.9475</td>
</tr>
<tr class="odd">
<td align="left">DSh</td>
<td align="right">104.1294</td>
<td align="right">82.4709</td>
<td align="right">57.5069</td>
<td align="right">45.2324</td>
<td align="right">40.5008</td>
</tr>
<tr class="even">
<td align="left">Sh</td>
<td align="right">105.6656</td>
<td align="right">82.8127</td>
<td align="right">57.8924</td>
<td align="right">45.0648</td>
<td align="right">40.1208</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="gamma-glms">Gamma GLMs<a class="anchor" aria-label="anchor" href="#gamma-glms"></a>
</h3>
<div class="section level4">
<h4 id="log-link-function-1">
<em>log</em> Link Function<a class="anchor" aria-label="anchor" href="#log-link-function-1"></a>
</h4>
<p>In Gamma GLMs with the log link, the mean response is given by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î·</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu = \exp(\eta)</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î·</mi><mo>=</mo><msub><mi>X</mi><mtext mathvariant="normal">intercept</mtext></msub><mspace width="0.167em"></mspace><msub><mi>Î²</mi><mtext mathvariant="normal">true</mtext></msub></mrow><annotation encoding="application/x-tex">\eta = X_{\text{intercept}} \, \beta_{\text{true}}</annotation></semantics></math>.
Covariates are generated as before, and responses are drawn from a Gamma
distribution with <em>shape</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î·</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu =\exp(\eta)</annotation></semantics></math>.
A retry mechanism is used to ensure that all simulated responses are
positive, which is required by the Gamma model. Models are fit using
both the standard GLM (via <code>glm.fit2</code>) and the
shrinkage-based GLM (via <code>savvy_glm.fit2</code>in
<code>savvyGLM</code> package).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ziwei-ChenChen.github.io/savvyGLM">savvyGLM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glm2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvxr.rbind.io" class="external-link">CVXR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_val</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">p_val</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">rho_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.75</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">mu_val</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">control_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">250</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">family_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sigma.rho</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">theta_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">base_increment</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span>  <span class="va">growth_rate</span> <span class="op">&lt;-</span> <span class="fl">0.95</span> </span>
<span>  <span class="va">betas</span> <span class="op">&lt;-</span> <span class="va">base_increment</span> <span class="op">*</span> <span class="op">(</span><span class="va">growth_rate</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">p_val</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">betas</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">p_val</span><span class="op">]</span></span>
<span>  <span class="va">signs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span></span>
<span>  <span class="va">betas</span> <span class="op">&lt;-</span> <span class="va">betas</span> <span class="op">*</span> <span class="va">signs</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">findStartingValues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Variable-class.html" class="external-link">Variable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">objective</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Minimize-class.html" class="external-link">Minimize</a></span><span class="op">(</span><span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/sum_squares.html" class="external-link">sum_squares</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">-</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Problem-class.html" class="external-link">Problem</a></span><span class="op">(</span><span class="va">objective</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">starting_values</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OLS"</span>, <span class="st">"SR"</span>, <span class="st">"GSR"</span>, <span class="st">"St"</span>, <span class="st">"DSh"</span>, <span class="st">"Sh"</span><span class="op">)</span></span>
<span><span class="va">l2_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span>,</span>
<span>                    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"rho="</span>, <span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">&lt;-</span> <span class="va">rho_vals</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu">sigma.rho</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">n_val</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mu_val</span>, <span class="va">p_val</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span></span>
<span>  <span class="va">X_intercept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span><span class="op">)</span></span>
<span>  <span class="va">beta_true</span> <span class="op">&lt;-</span> <span class="fu">theta_func</span><span class="op">(</span><span class="va">p_val</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">mu_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X_intercept</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_true</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_val</span>, shape <span class="op">=</span> <span class="va">mu_y</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">retry_count</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">retry_count</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">bad_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">bad_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bad_idx</span><span class="op">)</span>, shape <span class="op">=</span> <span class="va">mu_y</span><span class="op">[</span><span class="va">bad_idx</span><span class="op">]</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">retry_count</span> <span class="op">&lt;-</span> <span class="va">retry_count</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu">findStartingValues</span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fit_ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glm2/man/glm.fit2.html" class="external-link">glm.fit2</a></span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span>, start <span class="op">=</span> <span class="va">starting_values</span>,</span>
<span>                      control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>  <span class="va">l2_matrix</span><span class="op">[</span><span class="st">"OLS"</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit_ols</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/savvy_glm.fit2.html">savvy_glm.fit2</a></span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span>, model_class <span class="op">=</span> <span class="va">m</span>,</span>
<span>                           start <span class="op">=</span> <span class="va">starting_values</span>, control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>    <span class="va">l2_matrix</span><span class="op">[</span><span class="va">m</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A summary table here is produced to compare these distances across
different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l2_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">l2_matrix</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">l2_table</span>, digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"L2 Distance Between Estimated and True Coefficients (log link for Gamma GLM)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>L2 Distance Between Estimated and True Coefficients (log link
for Gamma GLM)</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">rho=-0.75</th>
<th align="right">rho=-0.5</th>
<th align="right">rho=0</th>
<th align="right">rho=0.5</th>
<th align="right">rho=0.75</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">OLS</td>
<td align="right">0.4254</td>
<td align="right">0.2821</td>
<td align="right">0.1926</td>
<td align="right">0.3676</td>
<td align="right">0.4349</td>
</tr>
<tr class="even">
<td align="left">SR</td>
<td align="right">0.3941</td>
<td align="right">0.2812</td>
<td align="right">0.1919</td>
<td align="right">0.3652</td>
<td align="right">0.4345</td>
</tr>
<tr class="odd">
<td align="left">GSR</td>
<td align="right">0.3001</td>
<td align="right">0.2103</td>
<td align="right">0.1742</td>
<td align="right">0.3101</td>
<td align="right">0.3238</td>
</tr>
<tr class="even">
<td align="left">St</td>
<td align="right">0.2670</td>
<td align="right">0.2179</td>
<td align="right">0.1627</td>
<td align="right">0.2818</td>
<td align="right">0.3337</td>
</tr>
<tr class="odd">
<td align="left">DSh</td>
<td align="right">0.3171</td>
<td align="right">0.2600</td>
<td align="right">0.2052</td>
<td align="right">0.3366</td>
<td align="right">0.3509</td>
</tr>
<tr class="even">
<td align="left">Sh</td>
<td align="right">0.4102</td>
<td align="right">0.2777</td>
<td align="right">0.1894</td>
<td align="right">0.3605</td>
<td align="right">0.4205</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="sqrt-link-function-1">
<em>sqrt</em> Link Function<a class="anchor" aria-label="anchor" href="#sqrt-link-function-1"></a>
</h4>
<p>For Gamma GLMs with the square-root link, the mean response is
modeled as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><msup><mi>Î·</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\mu = \eta^2</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î·</mi><mo>=</mo><msub><mi>X</mi><mtext mathvariant="normal">intercept</mtext></msub><mspace width="0.167em"></mspace><msub><mi>Î²</mi><mtext mathvariant="normal">true</mtext></msub></mrow><annotation encoding="application/x-tex">\eta = X_{\text{intercept}} \, \beta_{\text{true}}</annotation></semantics></math>.
Covariates are generated as before, and responses are drawn from a Gamma
distribution with <em>shape</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><msup><mi>Î·</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\mu =\eta^2</annotation></semantics></math>,
including a retry mechanism to ensure all response values are positive.
Fitting the models using both the standard GLM (via
<code>glm.fit2</code>) and the shrinkage-based GLM (via
<code>savvy_glm.fit2</code>in <code>savvyGLM</code> package).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ziwei-ChenChen.github.io/savvyGLM">savvyGLM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glm2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvxr.rbind.io" class="external-link">CVXR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_val</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">p_val</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">rho_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.75</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">mu_val</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">control_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">250</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">family_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"sqrt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sigma.rho</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="fl">1</span><span class="op">:</span><span class="va">p_val</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">theta_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sgn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span></span>
<span>  <span class="va">mag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">sgn</span> <span class="op">*</span> <span class="va">mag</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">findStartingValues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">epsilon</span> <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Variable-class.html" class="external-link">Variable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">objective</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Minimize-class.html" class="external-link">Minimize</a></span><span class="op">(</span><span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/sum_squares.html" class="external-link">sum_squares</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">-</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">eta</span> <span class="op">&gt;=</span> <span class="va">epsilon</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Problem-class.html" class="external-link">Problem</a></span><span class="op">(</span><span class="va">objective</span>, <span class="va">constraints</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">starting_values</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OLS"</span>, <span class="st">"SR"</span>, <span class="st">"GSR"</span>, <span class="st">"St"</span>, <span class="st">"DSh"</span>, <span class="st">"Sh"</span><span class="op">)</span></span>
<span><span class="va">l2_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span>,</span>
<span>                    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"rho="</span>, <span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">rho_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rho_val</span> <span class="op">&lt;-</span> <span class="va">rho_vals</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu">sigma.rho</span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">p_val</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">n_val</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mu_val</span>, <span class="va">p_val</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">Sigma</span><span class="op">)</span></span>
<span>  <span class="va">X_intercept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span><span class="op">)</span></span>
<span>  <span class="va">beta_true</span> <span class="op">&lt;-</span> <span class="fu">theta_func</span><span class="op">(</span><span class="va">p_val</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">mu_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="op">(</span><span class="va">X_intercept</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_true</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_val</span>, shape <span class="op">=</span> <span class="va">mu_y</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">retry_count</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">while</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">retry_count</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">bad_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">bad_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bad_idx</span><span class="op">)</span>, shape <span class="op">=</span> <span class="va">mu_y</span><span class="op">[</span><span class="va">bad_idx</span><span class="op">]</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">retry_count</span> <span class="op">&lt;-</span> <span class="va">retry_count</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu">findStartingValues</span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fit_ols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glm2/man/glm.fit2.html" class="external-link">glm.fit2</a></span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span>, start <span class="op">=</span> <span class="va">starting_values</span>,</span>
<span>                      control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>  <span class="va">l2_matrix</span><span class="op">[</span><span class="st">"OLS"</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit_ols</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/savvy_glm.fit2.html">savvy_glm.fit2</a></span><span class="op">(</span><span class="va">X_intercept</span>, <span class="va">y</span>, model_class <span class="op">=</span> <span class="va">m</span>,</span>
<span>                           start <span class="op">=</span> <span class="va">starting_values</span>, control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>    <span class="va">l2_matrix</span><span class="op">[</span><span class="va">m</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">norm</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">-</span> <span class="va">beta_true</span>, type <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A summary table here is produced to compare these distances across
different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
values.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l2_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">l2_matrix</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">l2_table</span>, digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"L2 Distance Between Estimated and True Coefficients (sqrt link for Gamma GLM)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>L2 Distance Between Estimated and True Coefficients (sqrt link
for Gamma GLM)</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">rho=-0.75</th>
<th align="right">rho=-0.5</th>
<th align="right">rho=0</th>
<th align="right">rho=0.5</th>
<th align="right">rho=0.75</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">OLS</td>
<td align="right">107.8225</td>
<td align="right">81.8266</td>
<td align="right">56.4835</td>
<td align="right">45.4632</td>
<td align="right">40.4655</td>
</tr>
<tr class="even">
<td align="left">SR</td>
<td align="right">107.8121</td>
<td align="right">81.8224</td>
<td align="right">56.4548</td>
<td align="right">45.4602</td>
<td align="right">40.4746</td>
</tr>
<tr class="odd">
<td align="left">GSR</td>
<td align="right">104.3230</td>
<td align="right">80.3020</td>
<td align="right">55.5819</td>
<td align="right">45.3778</td>
<td align="right">40.4913</td>
</tr>
<tr class="even">
<td align="left">St</td>
<td align="right">102.0399</td>
<td align="right">79.3341</td>
<td align="right">55.8032</td>
<td align="right">45.0603</td>
<td align="right">40.2149</td>
</tr>
<tr class="odd">
<td align="left">DSh</td>
<td align="right">105.1456</td>
<td align="right">81.0958</td>
<td align="right">55.9391</td>
<td align="right">45.8814</td>
<td align="right">40.3181</td>
</tr>
<tr class="even">
<td align="left">Sh</td>
<td align="right">107.7353</td>
<td align="right">81.7724</td>
<td align="right">56.4640</td>
<td align="right">45.4739</td>
<td align="right">40.4802</td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="real-data-analysis">Real Data Analysis<a class="anchor" aria-label="anchor" href="#real-data-analysis"></a>
</h2>
<p>In this section, we evaluate the performance of Gamma GLM estimation
methods using real flood insurance data from three states: Florida (FL),
Texas (TX), and Louisiana (LA). The dataset covers the period 2014 to
2023 and includes claims from the <a href="https://www.fema.gov/openfema-data-page/fima-nfip-redacted-claims-v2" class="external-link">National
Flood Insurance Programme (NFIP)</a>. For each state (e.g., Florida (FL)
and Louisiana (LA)), the data are no provided here, but you can download
from <a href="https://www.fema.gov/openfema-data-page/fima-nfip-redacted-claims-v2" class="external-link">NFIP</a>
and follow the preprocess steps provided in the paper.</p>
<p>For each year, the dataset is split into a 70% training set and a 30%
test set. Models are fitted using the standard GLM (via
<code>glm.fit2</code>) and several shrinkage-based GLM (via
<code>savvy_glm.fit2</code> with model classes such as SR, GSR, St, DSh,
and optionally Sh) using two different link functions:</p>
<ul>
<li><p>For Gamma GLMs with the <strong>log link</strong>, the mean
response is modeled as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î·</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu = \exp(\eta)</annotation></semantics></math>.</p></li>
<li><p>For Gamma GLMs with the <strong>square-root link</strong>, the
mean response is modeled as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>=</mo><msup><mi>Î·</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\mu = \eta^2</annotation></semantics></math>.</p></li>
</ul>
<p>For each replication, the Mean Squared Error (MSE) on the test set is
computed. For each shrinkage-based GLM, we calculate the ratio</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">MSE Ratio</mtext><mo>=</mo><mfrac><msub><mtext mathvariant="normal">MSE</mtext><mtext mathvariant="normal">Baseline (OLS)</mtext></msub><msub><mtext mathvariant="normal">MSE</mtext><mtext mathvariant="normal">Shrinkage</mtext></msub></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\text{MSE Ratio} = \frac{\text{MSE}_{\text{Baseline (OLS)}}}{\text{MSE}_{\text{Shrinkage}}}.
</annotation></semantics></math></p>
<p>A ratio greater than one indicates that the shrinkage-based GLM
achieved a lower MSE (i.e., superior performance) compared to the
standard update. This process is repeated multiple times (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">N=100</annotation></semantics></math>
replications per year), and the average ratio is computed for each model
and each year.</p>
<p>Here, we just provide two cases and for a detailed account of the
full data processing and evaluation procedures, please refer to the <a href="http//...">main paper</a>.</p>
<hr>
<div class="section level3">
<h3 id="fl-dataset-with-log-link-function">FL dataset with <em>log</em> Link Function<a class="anchor" aria-label="anchor" href="#fl-dataset-with-log-link-function"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ziwei-ChenChen.github.io/savvyGLM">savvyGLM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glm2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvxr.rbind.io" class="external-link">CVXR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">2014</span><span class="op">:</span><span class="fl">2015</span></span>
<span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OLS"</span>, <span class="st">"SR"</span>, <span class="st">"GSR"</span>, <span class="st">"St"</span>, <span class="st">"DSh"</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">control_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">250</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">family_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Evaluation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                             dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="va">years</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">findStartingValues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Variable-class.html" class="external-link">Variable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">objective</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Minimize-class.html" class="external-link">Minimize</a></span><span class="op">(</span><span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/sum_squares.html" class="external-link">sum_squares</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">-</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Problem-class.html" class="external-link">Problem</a></span><span class="op">(</span><span class="va">objective</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">starting_values</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">calculate_mse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">true_values</span>, <span class="va">predicted_values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_values</span> <span class="op">-</span> <span class="va">predicted_values</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">yr</span> <span class="kw">in</span> <span class="va">years</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Processing year:"</span>, <span class="va">yr</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"FL_data_%d.csv"</span>, <span class="va">yr</span><span class="op">)</span></span>
<span>  <span class="va">data_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">filename</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ratio_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">N</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ratio_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">yr</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">+</span> <span class="va">i</span><span class="op">)</span></span>
<span>    <span class="va">train_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createDataPartition</a></span><span class="op">(</span><span class="va">data_year</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, p <span class="op">=</span> <span class="fl">0.7</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">data_year</span><span class="op">[</span><span class="va">train_index</span>, <span class="op">]</span></span>
<span>    <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">data_year</span><span class="op">[</span><span class="op">-</span><span class="va">train_index</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">X_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">X_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">X_train_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X_train</span><span class="op">)</span></span>
<span>    <span class="va">X_test_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X_test</span><span class="op">)</span></span>
<span>    <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu">findStartingValues</span><span class="op">(</span><span class="va">X_train_int</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="va">model_glm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glm2/man/glm.fit2.html" class="external-link">glm.fit2</a></span><span class="op">(</span><span class="va">X_train_int</span>, <span class="va">y_train</span>, start <span class="op">=</span> <span class="va">starting_values</span>,</span>
<span>                           control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>    <span class="va">y_pred_glm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X_test_int</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">model_glm2</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span></span>
<span>    <span class="va">mse_ols</span> <span class="op">&lt;-</span> <span class="fu">calculate_mse</span><span class="op">(</span><span class="va">y_test</span>, <span class="va">y_pred_glm2</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">model_savvy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/savvy_glm.fit2.html">savvy_glm.fit2</a></span><span class="op">(</span><span class="va">X_train_int</span>, <span class="va">y_train</span>, model_class <span class="op">=</span> <span class="va">m</span>,</span>
<span>                                      start <span class="op">=</span> <span class="va">starting_values</span>, control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>      <span class="va">y_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X_test_int</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">model_savvy</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span></span>
<span>      <span class="va">mse_savvy</span> <span class="op">&lt;-</span> <span class="fu">calculate_mse</span><span class="op">(</span><span class="va">y_test</span>, <span class="va">y_pred</span><span class="op">)</span></span>
<span>      <span class="va">ratio_mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">m</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mse_ols</span> <span class="op">/</span> <span class="va">mse_savvy</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">avg_ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">ratio_mat</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Evaluation_results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">yr</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">avg_ratios</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Evaluation_results_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Evaluation_results</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">Evaluation_results_df</span>, digits <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Average MSE Ratio (OLS / Shrinkage) for Each Year (Gamma GLM with Log Link)"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="la-dataset-with-sqrt-link-function">LA dataset with <em>sqrt</em> Link Function<a class="anchor" aria-label="anchor" href="#la-dataset-with-sqrt-link-function"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Ziwei-ChenChen.github.io/savvyGLM">savvyGLM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">glm2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cvxr.rbind.io" class="external-link">CVXR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">2014</span><span class="op">:</span><span class="fl">2023</span></span>
<span><span class="va">model_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OLS"</span>, <span class="st">"SR"</span>, <span class="st">"GSR"</span>, <span class="st">"St"</span>, <span class="st">"DSh"</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">control_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">250</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">family_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"sqrt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Evaluation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                             dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="va">years</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">findStartingValues</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">epsilon</span> <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Variable-class.html" class="external-link">Variable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">objective</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Minimize-class.html" class="external-link">Minimize</a></span><span class="op">(</span><span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/sum_squares.html" class="external-link">sum_squares</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">-</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">eta</span> <span class="op">&gt;=</span> <span class="va">epsilon</span><span class="op">)</span></span>
<span>  <span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.cvxgrp.org/CVXR/reference/Problem-class.html" class="external-link">Problem</a></span><span class="op">(</span><span class="va">objective</span>, <span class="va">constraints</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem</span><span class="op">)</span></span>
<span>  <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">starting_values</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">calculate_mse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">true_values</span>, <span class="va">predicted_values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">true_values</span> <span class="op">-</span> <span class="va">predicted_values</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">yr</span> <span class="kw">in</span> <span class="va">years</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Processing year:"</span>, <span class="va">yr</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"LA_data_%d.csv"</span>, <span class="va">yr</span><span class="op">)</span></span>
<span>  <span class="va">data_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">filename</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ratio_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">N</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_names</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ratio_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">yr</span> <span class="op">*</span> <span class="fl">1000</span> <span class="op">+</span> <span class="va">i</span><span class="op">)</span></span>
<span>    <span class="va">train_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createDataPartition</a></span><span class="op">(</span><span class="va">data_year</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, p <span class="op">=</span> <span class="fl">0.7</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">data_year</span><span class="op">[</span><span class="va">train_index</span>, <span class="op">]</span></span>
<span>    <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">data_year</span><span class="op">[</span><span class="op">-</span><span class="va">train_index</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="va">X_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">X_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test_data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">X_train_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X_train</span><span class="op">)</span></span>
<span>    <span class="va">X_test_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X_test</span><span class="op">)</span></span>
<span>    <span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu">findStartingValues</span><span class="op">(</span><span class="va">X_train_int</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="va">model_glm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glm2/man/glm.fit2.html" class="external-link">glm.fit2</a></span><span class="op">(</span><span class="va">X_train_int</span>, <span class="va">y_train</span>, start <span class="op">=</span> <span class="va">starting_values</span>,</span>
<span>                           control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>    <span class="va">y_pred_glm2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">X_test_int</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">model_glm2</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="va">mse_ols</span> <span class="op">&lt;-</span> <span class="fu">calculate_mse</span><span class="op">(</span><span class="va">y_test</span>, <span class="va">y_pred_glm2</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="va">model_names</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">model_savvy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/savvy_glm.fit2.html">savvy_glm.fit2</a></span><span class="op">(</span><span class="va">X_train_int</span>, <span class="va">y_train</span>, model_class <span class="op">=</span> <span class="va">m</span>,</span>
<span>                                      start <span class="op">=</span> <span class="va">starting_values</span>, control <span class="op">=</span> <span class="va">control_list</span>, family <span class="op">=</span> <span class="va">family_type</span><span class="op">)</span></span>
<span>      <span class="va">y_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X_test_int</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">model_savvy</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span></span>
<span>      <span class="va">mse_savvy</span> <span class="op">&lt;-</span> <span class="fu">calculate_mse</span><span class="op">(</span><span class="va">y_test</span>, <span class="va">y_pred</span><span class="op">)</span></span>
<span>      <span class="va">ratio_mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">m</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mse_ols</span> <span class="op">/</span> <span class="va">mse_savvy</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">avg_ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">ratio_mat</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Evaluation_results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">yr</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">avg_ratios</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Evaluation_results_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Evaluation_results</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">Evaluation_results_df</span>, digits <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Average MSE Ratio (OLS / Shrinkage) for Each Year (Gamma GLM with Log Link)"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ziwei Chen, Vali Asimit.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
